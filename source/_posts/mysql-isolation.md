---
title: mysql隔离级别
date: 2020-07-01 00:53:16
tags: 
- mysql
- 事务
- 隔离级别
categories:
- mysql
---
# 背景知识
> 显示当前隔离级别
> ```show variables like 'transaction_isolation';```
> 显示正在运行的事务数量
> ```select * from information_schema.innodb_trx;```
## 数据库常见问题
### 脏读
读到了其他事务未提交的数据，可能最终不会存到数据库中。
### 幻读
当前事务会读取到当前事务外新添加的数据。
### 不可重复读
当前事务会读取到当前事务外新修改的数据。
## 数据库隔离级别
### 读未提交
可以读取到别的事务没有提交的数据，会出现脏读、幻读、不可重复读
### 读已提交
只能读取到别的事务已经提交的数据，会出现幻读和不可重复读
### 可重复读
可能会出现幻读，mysql默认隔离级别
### 串行化
抛弃并发性能，不会出现脏读、幻读、不可重复读

---
# 试验
> 假设有数据age为1
1. 同时开启两个事务，事务A和事务B
2. 事务A修改age为10，然后提交
3. 在事务B内，select age仍然为显示为1(可重复读)
4. 此时在事务B内执行 update age+1
5. 在事务B内，select age显示为11(当前事务内的更新，可以读到. mvvc)
---
# 原理
## 实现可重复读
MySQL采用了MVVC(多版本并发控制)的方式。

数据库表中看到的一行记录可能实际上有多个版本，
每个版本的记录除了有数据本身外，还要有一个表示版本的字段，记为 row trx_id，
而这个字段就是事务的id，事务id记为 transaction id，
它在事务开始的时候向事务系统申请，按时间先后顺序递增。

快照，可重复读是在事务开始的时候生成一个当前事务全局性的快照，而读提交则是每次执行语句的时候都重新生成一次快照。

对于一个快照来说，它能够读到：
1. 当前事务内的更新，可以读到；
2. 版本(别的事务)未提交，不能读到；
3. 版本(别的事务)已提交，但是却在快照(当前事务)创建后提交的，不能读到；
4. 版本(别的事务)已提交，且是在快照(当前事务)创建前提交的，可以读到；
